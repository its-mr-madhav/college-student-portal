<div class="welcom_admin">
  <div class="welcom_admin_inner">
    <div class="heding_top">
      <span>Attendances</span>
    </div>
    <% if @students.present? %>
      <h5>All Attendances for <%= Time.now.strftime("%d/%m/%Y") %>:</h5>
      <table class="table table-hover table-striped">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Student Name</th>
            <th scope="col">Present</th>
          </tr>
        </thead>
        <tbody>
          <% @students.each_with_index do |student,index| %>
          <tr>
            <th scope="row"><%= index+1 %></th>
            <td><%= student.name.capitalize %></td>
            <td>
              <% is_present = student.attendances.where("DATE(created_at) = ?", Date.today).blank? || (student.attendances.where("DATE(created_at) = ?", Date.today).first[:present] == false) ? false : true %>
              <%= check_box_tag "student#{student.id}", student.id, is_present, :class => "is-present", data: {absent_present_student_url: faculty_attendance_path(student.id)} %>
            </td>
            </td>
          </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <h5>No Student Found</h5>
    <% end %>
  </div>
</div>
<script type="text/javascript">
  $(".is-present").click(function(){
    $.ajax({
      url: $(this).data('absent-present-student-url'),
      method: 'PATCH',
      success: function(data){
        data.present ? toastr.success('Marked Present') : toastr.info('Marked Absent')
      },
      error: function(data){
        toastr.info('Something went wrong, please try later!')
      }
    });
  });
</script>
